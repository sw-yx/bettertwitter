import { writable, derived } from 'svelte/store';

export const settings = writable({
  filters: {}
});

export const tweetURL = derived(settings, obj => {
  let final = ''
  Object.keys(obj).forEach(k => {
    if (k === 'filters') return
    if (k === 'search') {
      // special
      final = final.concat(obj[k]).concat(' ')
    } else if (obj[k]) {
      final = final.concat(`${k}:${obj[k]} `)
    }
  })
  Object.values(obj.filters).forEach(([filter, filterState]) => {
    if (filterState === 'filterFor') final = final.concat(`filter:${filter} `)
    if (filterState === 'filterOut') final = final.concat(`!filter:${filter} `)
  })
  if (obj.seeFollow) final = final.concat(`filter:follows `)
  if (obj.minLikes > 0) final = final.concat(`min_faves:${obj.minLikes} `)
  if (obj.minRTs > 0) final = final.concat(`min_retweets:${obj.minRTs} `)
  return `https://mobile.twitter.com/search?src=typd&f=live&q=${encodeURIComponent(final)}`
})