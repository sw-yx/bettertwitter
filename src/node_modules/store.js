import { writable, derived } from 'svelte/store';

export const settings = writable({
  filters: {}
});

export const tweetURL = derived(settings, obj => {
  let final = ''
  let header = 'https://nitter.net'
  Object.keys(obj).forEach(k => {
    if (k === 'filters') return
    if (k === 'searchKeyword') {
      // special
      final = final.concat(obj[k] || '').concat(' ')
    } else if (obj[k]) {
      final = final.concat(`${k}:${obj[k]} `)
    }
  })
  Object.entries(obj.filters).forEach(([filter, filterState]) => {
    if (filterState === 'filterFor') final = final.concat(`filter:${filter} `)
    if (filterState === 'filterOut') final = final.concat(`!filter:${filter} `)
  })
  if (obj.seeFollow) {
    delete obj.seeFollow
    final = final.concat(`filter:follows `)
    header = 'https://mobile.twitter.com'
  }
  if (obj.minLikes > 0) final = final.concat(`min_faves:${obj.minLikes} `)
  if (obj.minRTs > 0) final = final.concat(`min_retweets:${obj.minRTs} `)
  // return `https://mobile.twitter.com/search?src=typd&f=live&q=${encodeURIComponent(final)}`
  return `${header}/search?f=tweets&q=${encodeURIComponent(final)}`
})